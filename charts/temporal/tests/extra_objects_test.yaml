suite: test extra objects
templates:
  - extra-objects.yaml
tests:
  - it: does not render anything when extraObjects is empty
    asserts:
      - not: true
        containsDocument:
          kind: "*"
  - it: renders extraObjects correctly
    set:
      extraObjects:
        - apiVersion: v1
          kind: ConfigMap
          metadata:
            name: test-config
          data:
            key: value
        - apiVersion: external-secrets.io/v1beta1
          kind: ExternalSecret
          metadata:
            name: test-secret
          spec:
            secretStoreRef:
              name: test-store
              kind: SecretStore
            target:
              name: test-target
            data:
            - secretKey: password
              remoteRef:
                key: test/key
                property: password
    asserts:
      - containsDocument:
          kind: ConfigMap
          apiVersion: v1
      - equal:
          path: metadata.name
          value: test-config
      - containsDocument:
          kind: ExternalSecret
          apiVersion: external-secrets.io/v1beta1
      - equal:
          path: metadata.name
          value: test-secret