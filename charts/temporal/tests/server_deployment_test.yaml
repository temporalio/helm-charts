suite: test server deployment
templates:
  - server-deployment.yaml
  - server-configmap.yaml
set:
  server:
    replicaCount: 2
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 200m
        memory: 256Mi
    frontend:
      replicaCount: 3
      resources:
        requests:
          cpu: 200m
          memory: 256Mi
        limits:
          cpu: 400m
          memory: 512Mi
tests:
  - it: defaults to service wide replica count
    template: templates/server-deployment.yaml
    documentSelector:
      path: '$[?(@.metadata.name != "RELEASE-NAME-temporal-frontend")].kind'
      value: Deployment
      matchMany: true
    asserts:
      - equal:
          path: spec.replicas
          value: 2
  - it: favours service specific replica count
    template: templates/server-deployment.yaml
    documentSelector:
      path: metadata.name
      value: RELEASE-NAME-temporal-frontend
    asserts:
      - equal:
          path: spec.replicas
          value: 3
  - it: defaults to service wide resources
    template: templates/server-deployment.yaml
    documentSelector:
      path: '$[?(@.metadata.name != "RELEASE-NAME-temporal-frontend")].kind'
      value: Deployment
      matchMany: true
    asserts:
      - equal:
          path: spec.template.spec.containers[0].resources.requests.cpu
          value: 100m
  - it: favours service specific resources
    template: templates/server-deployment.yaml
    documentSelector:
      path: metadata.name
      value: RELEASE-NAME-temporal-frontend
    asserts:
      - equal:
          path: spec.template.spec.containers[0].resources.requests.cpu
          value: 200m
